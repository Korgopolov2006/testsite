{% extends 'paint_shop_project/base.html' %}
{% load static %}

{% block title %}Жевжик Клуб - Карта лояльности{% endblock %}

{% block extra_css %}
<style>
    :root {
        --zhevzhik-pink: #FF6B9D;
        --zhevzhik-dark-pink: #E91E63;
        --zhevzhik-light-pink: #FFB3D1;
        --zhevzhik-green: #4CAF50;
        --zhevzhik-yellow: #FFEB3B;
        --zhevzhik-gray: #6c757d;
        --zhevzhik-dark-gray: #2c3e50;
    }
    
    .loyalty-card {
        background: linear-gradient(135deg, var(--zhevzhik-pink), var(--zhevzhik-light-pink));
        color: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
        position: relative;
        overflow: hidden;
    }
    
    .loyalty-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    .card-number {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 10px;
        position: relative;
        z-index: 2;
    }
    
    .card-level {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        background: rgba(255,255,255,0.2);
        font-size: 0.9rem;
        margin-bottom: 20px;
        position: relative;
        z-index: 2;
    }
    
    .points-display {
        font-size: 3rem;
        font-weight: bold;
        margin: 20px 0;
        position: relative;
        z-index: 2;
    }
    
    .level-progress {
        background: rgba(255,255,255,0.2);
        border-radius: 10px;
        height: 20px;
        margin: 20px 0;
        position: relative;
        z-index: 2;
    }
    
    .level-progress-bar {
        background: var(--zhevzhik-yellow);
        height: 100%;
        border-radius: 10px;
        transition: width 0.3s ease;
    }
    
    .transaction-item {
        background: white;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-left: 4px solid var(--zhevzhik-pink);
    }
    
    .transaction-earned {
        border-left-color: var(--zhevzhik-green);
    }
    
    .transaction-spent {
        border-left-color: var(--zhevzhik-orange);
    }
    
    .transaction-bonus {
        border-left-color: var(--zhevzhik-yellow);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <!-- Карта лояльности -->
            <div class="loyalty-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="card-number">{{ loyalty_card.card_number }}</div>
                        <div class="card-level">{{ loyalty_card.get_level_display }}</div>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-piggy-bank fa-3x" style="opacity: 0.3;"></i>
                    </div>
                </div>
                
                <div class="points-display">{{ loyalty_card.points }} баллов</div>
                
                <div class="level-progress">
                    <div class="level-progress-bar" style="width: {{ loyalty_card.points|floatformat:0 }}%"></div>
                </div>
                
                <p class="mb-0">Накопите больше баллов для повышения уровня!</p>
            </div>
            
            <!-- История транзакций -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-history me-2"></i>История транзакций</h5>
                </div>
                <div class="card-body">
                    {% for transaction in transactions %}
                    <div class="transaction-item transaction-{{ transaction.transaction_type }}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ transaction.get_transaction_type_display }}</strong>
                                <br>
                                <small class="text-muted">{{ transaction.description }}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge {% if transaction.points > 0 %}bg-success{% else %}bg-warning{% endif %}">
                                    {% if transaction.points > 0 %}+{% endif %}{{ transaction.points }}
                                </span>
                                <br>
                                <small class="text-muted">{{ transaction.created_at|date:"d.m.Y H:i" }}</small>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-receipt fa-3x mb-3"></i>
                        <p>Пока нет транзакций</p>
                        <p>Совершите первую покупку, чтобы начать накапливать баллы!</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- Информация о программе -->
            <div class="card mb-4">
                <div class="card-header bg-zhevzhik-pink text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>О программе</h5>
                </div>
                <div class="card-body">
                    <p><strong>Как накапливать баллы:</strong></p>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success me-2"></i>1 рубль = 1 балл</li>
                        <li><i class="fas fa-check text-success me-2"></i>Бонусы за отзывы</li>
                        <li><i class="fas fa-check text-success me-2"></i>Специальные акции</li>
                    </ul>
                    
                    <p><strong>Как тратить баллы:</strong></p>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-star text-warning me-2"></i>1 балл = 1 рубль скидки</li>
                        <li><i class="fas fa-star text-warning me-2"></i>Скидки до {{ loyalty_card.get_discount_percent }}%</li>
                    </ul>
                </div>
            </div>
            
            <!-- Быстрые действия -->
            <div class="card">
                <div class="card-header bg-zhevzhik-yellow text-dark">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Быстрые действия</h5>
                </div>
                <div class="card-body">
                    <a href="{% url 'product_list' %}" class="btn btn-zhevzhik-pink w-100 mb-2">
                        <i class="fas fa-shopping-cart me-2"></i>Продолжить покупки
                    </a>
                    <a href="{% url 'loyalty_levels' %}" class="btn btn-outline-zhevzhik-pink w-100 mb-2">
                        <i class="fas fa-trophy me-2"></i>Уровни программы
                    </a>
                    <a href="{% url 'order_history' %}" class="btn btn-outline-zhevzhik-pink w-100">
                        <i class="fas fa-list me-2"></i>История заказов
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
