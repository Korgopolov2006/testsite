{% extends 'paint_shop_project/base.html' %}
{% load static %}

{% block title %}–ù–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã - –ñ–µ–≤–∂–∏–∫{% endblock %}

{% block extra_css %}
<style>
    :root {
        --zhevzhik-pink: #FF6B9D;
        --zhevzhik-dark-pink: #E91E63;
        --zhevzhik-light-pink: #FFB3D1;
        --zhevzhik-green: #4CAF50;
        --zhevzhik-yellow: #FFEB3B;
        --zhevzhik-gray: #6c757d;
        --zhevzhik-dark-gray: #2c3e50;
    }
    .stores-hero {
        background: linear-gradient(135deg, var(--zhevzhik-pink), var(--zhevzhik-light-pink));
        color: white;
        padding: 50px 0;
        text-align: center;
        margin-bottom: 40px;
    }
    
    .store-card {
        background: var(--card-bg, white);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        margin-bottom: 30px;
        color: var(--text-color, var(--zhevzhik-dark-gray));
    }
    
    .store-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .store-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }
    
    .store-content {
        padding: 25px;
    }
    
    .store-name {
        color: var(--zhevzhik-pink);
        font-weight: 600;
        margin-bottom: 10px;
        font-size: 1.3rem;
    }
    
    .store-address {
        color: var(--text-color, var(--zhevzhik-dark-gray));
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }
    
    .store-address i {
        margin-right: 8px;
        color: var(--zhevzhik-pink);
    }
    
    .store-hours {
        color: var(--zhevzhik-gray);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }
    
    .store-hours i {
        margin-right: 8px;
        color: var(--zhevzhik-pink);
    }
    
    .store-phone {
        color: var(--text-color, var(--zhevzhik-dark-gray));
        margin-bottom: 20px;
        display: flex;
        align-items: center;
    }
    
    .store-phone i {
        margin-right: 8px;
        color: var(--zhevzhik-pink);
    }
    
    .store-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .btn-store {
        background: var(--zhevzhik-pink);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
    }
    
    .btn-store:hover {
        background: var(--zhevzhik-dark-pink);
        color: white;
        transform: translateY(-2px);
    }
    
    .btn-store i {
        margin-right: 5px;
    }
    
    .map-container {
        background: var(--card-bg, #f8f9fa);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        color: var(--text-color, var(--zhevzhik-dark-gray));
    }
    
    .map-embed {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .map-placeholder {
        background: var(--zhevzhik-light-gray);
        border-radius: 10px;
        padding: 40px;
        color: var(--zhevzhik-gray);
    }
    
    .section-title {
        color: var(--zhevzhik-pink);
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
    }
    
    .section-title i {
        margin-right: 10px;
    }
    
    .feature-icon {
        background: var(--zhevzhik-light-pink);
        color: var(--zhevzhik-pink);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        margin-bottom: 15px;
    }
    
    .feature-card {
        text-align: center;
        padding: 20px;
        background: var(--card-bg, white);
        border-radius: 15px;
        box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        color: var(--text-color, var(--zhevzhik-dark-gray));
    }
    
    .feature-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .stores-cta {
        background: linear-gradient(135deg, var(--card-bg, #ffffff), var(--zhevzhik-light-pink));
        color: var(--text-color, var(--zhevzhik-dark-gray));
        border: none;
    }

    .stores-cta h2,
    .stores-cta p {
        color: var(--text-color, var(--zhevzhik-dark-gray));
    }

    .stores-cta .btn-cta {
        background: var(--zhevzhik-pink);
        color: #ffffff;
        border: none;
        padding: 12px 28px;
        border-radius: 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .stores-cta .btn-cta:hover {
        background: var(--zhevzhik-dark-pink);
        color: #ffffff;
        transform: translateY(-2px);
    }

    .stores-filter {
        background: var(--card-bg, white);
        border-radius: 18px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        padding: 24px;
        margin-bottom: 30px;
        color: var(--text-color, var(--zhevzhik-dark-gray));
    }

    .stores-filter .form-control {
        border: 2px solid var(--border-color, #f1f2f6);
        border-radius: 14px;
        padding: 14px 18px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
        background-color: var(--input-bg, white);
        color: var(--text-color, var(--zhevzhik-dark-gray));
    }

    .stores-filter .form-control:focus {
        border-color: var(--zhevzhik-pink);
        box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
    }

    .btn-outline-zhevzhik-pink {
        border: 2px solid var(--zhevzhik-pink);
        color: var(--zhevzhik-pink);
        border-radius: 999px;
        padding: 10px 22px;
        font-weight: 600;
        transition: all 0.3s ease;
        background: transparent;
    }

    .btn-outline-zhevzhik-pink:hover,
    .btn-outline-zhevzhik-pink:focus {
        background: var(--zhevzhik-pink);
        color: #fff;
    }

    .btn-filter {
        border: 1px solid var(--border-color, rgba(26, 42, 108, 0.1));
        background: var(--input-bg, rgba(26, 42, 108, 0.04));
        color: var(--text-color, var(--zhevzhik-dark-gray));
        border-radius: 999px;
        padding: 8px 18px;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    .btn-filter:hover {
        background: var(--zhevzhik-pink);
        color: #fff;
        border-color: var(--zhevzhik-pink);
    }

    .stores-empty {
        display: none;
        text-align: center;
        padding: 60px 20px;
        color: var(--zhevzhik-gray);
    }

    .stores-empty i {
        font-size: 3rem;
        color: var(--zhevzhik-light-pink);
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ -->
<div class="stores-hero">
    <div class="container">
        <h1 class="display-4 mb-3">üè™ –ù–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã</h1>
        <p class="lead">–ù–∞–π–¥–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π –º–∞–≥–∞–∑–∏–Ω –ñ–µ–≤–∂–∏–∫ –∏ –∑–∞–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑</p>
    </div>
</div>

<div class="container">
    <!-- –ö–∞—Ä—Ç–∞ -->
    <div class="map-container">
        <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between mb-3">
            <div>
                <h3 class="section-title mb-0">
            <i class="fas fa-map-marker-alt"></i>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–æ–≤
        </h3>
                <p class="text-muted mb-0">–ù–∞ –∫–∞—Ä—Ç–µ –æ—Ç–º–µ—á–µ–Ω—ã –Ω–∞—à–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –ø—Ä–æ–¥–∞–∂ –∏ –ø—É–Ω–∫—Ç—ã —Å–∞–º–æ–≤—ã–≤–æ–∑–∞</p>
            </div>
            <a href="https://yandex.ru/maps/?um=constructor%3Afb4a9069499ed32b2008342da6f7807421006e52adfad87390169edc29a0ad4a&source=constructorLink" target="_blank" class="btn btn-outline-zhevzhik-pink mt-3 mt-lg-0">
                <i class="fas fa-external-link-alt me-2"></i>–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É –≤ –Ø–Ω–¥–µ–∫—Å
            </a>
        </div>
        <div class="map-embed">
            <script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3Afb4a9069499ed32b2008342da6f7807421006e52adfad87390169edc29a0ad4a&amp;width=100%25&amp;height=420&amp;lang=ru_RU&amp;scroll=true"></script>
        </div>
    </div>
    
    <!-- –§–∏–ª—å—Ç—Ä –º–∞–≥–∞–∑–∏–Ω–æ–≤ -->
    <div class="stores-filter">
        <div class="row align-items-center g-3">
            <div class="col-lg-6">
                <label for="storesSearchInput" class="form-label fw-semibold text-uppercase text-muted" style="letter-spacing:.18em;">–ü–æ–∏—Å–∫ –º–∞–≥–∞–∑–∏–Ω–∞</label>
                <input type="text" class="form-control" id="storesSearchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω">
                <small class="text-muted d-block mt-2">–ù–∞–π–¥–µ–Ω–æ <span id="storesVisibleCounter">{{ stores|length }}</span> {{ stores|length|pluralize:"–º–∞–≥–∞–∑–∏–Ω,–º–∞–≥–∞–∑–∏–Ω–∞,–º–∞–≥–∞–∑–∏–Ω–æ–≤" }}</small>
            </div>
            <div class="col-lg-6">
                <div class="d-flex flex-wrap gap-2 justify-content-lg-end">
                    <button type="button" class="btn-filter" data-suggest="—Ü–µ–Ω—Ç—Ä">–¶–µ–Ω—Ç—Ä</button>
                    <button type="button" class="btn-filter" data-suggest="–º–∞–≥–∞–∑–∏–Ω">–ú–∞–≥–∞–∑–∏–Ω</button>
                    <button type="button" class="btn-filter" data-suggest="—É–ª–∏—Ü–∞">–£–ª–∏—Ü–∞</button>
                    <button type="button" class="btn-filter" id="storesSearchReset">
                        <i class="fas fa-times me-1"></i>–°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="section-title">
                <i class="fas fa-store"></i>–í—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã
            </h2>
        </div>
    </div>
    
    <div class="row" id="storesList">
        {% for store in stores %}
        <div class="col-lg-4 col-md-6 store-column"
             data-store-name="{{ store.name|default:''|lower|escape }}"
             data-store-address="{{ store.address|default:''|lower|escape }}"
             data-store-phone="{{ store.phone|default:''|lower|escape }}">
            <div class="store-card">
                {% if store.image %}
                    <img src="{{ store.image.url }}" alt="{{ store.name }}" class="store-image">
                {% else %}
                    <div class="store-image bg-zhevzhik-light-pink d-flex align-items-center justify-content-center">
                        <i class="fas fa-store fa-3x text-white"></i>
                    </div>
                {% endif %}
                <div class="store-content">
                    <h3 class="store-name">{{ store.name }}</h3>
                    
                    <div class="store-address">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ store.address }}</span>
                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyAddress('{{ store.address }}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    
                    <div class="store-hours">
                        <i class="fas fa-clock"></i>
                        {{ store.working_hours }}
                    </div>
                    
                    <div class="store-phone">
                        <i class="fas fa-phone"></i>
                        <a href="tel:{{ store.phone }}" style="color: var(--zhevzhik-dark-gray); text-decoration: none;">{{ store.phone }}</a>
                    </div>
                    
                    <div class="store-actions">
                        <a href="tel:{{ store.phone }}" class="btn-store">
                            <i class="fas fa-phone"></i>–ü–æ–∑–≤–æ–Ω–∏—Ç—å
                        </a>
                        <a href="https://yandex.ru/maps/?text={{ store.address|urlencode }}" target="_blank" class="btn-store">
                            <i class="fas fa-route"></i>–ú–∞—Ä—à—Ä—É—Ç
                        </a>
                        <a href="{% url 'product_list' %}" class="btn-store">
                            <i class="fas fa-shopping-bag"></i>–ó–∞–∫–∞–∑–∞—Ç—å
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <i class="fas fa-store fa-3x text-zhevzhik-pink mb-3"></i>
            <h4>–ú–∞–≥–∞–∑–∏–Ω—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è!</h4>
            <p class="text-muted">–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –Ω–æ–≤—ã—Ö —Ç–æ—á–µ–∫</p>
        </div>
        {% endfor %}
    </div>
    
    <div class="stores-empty" id="storesEmptyState">
        <i class="fas fa-map-marked-alt mb-3"></i>
        <h4>–ù–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–∞–≥–∞–∑–∏–Ω</h4>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–±—Ä–æ—Å–∏—Ç—å¬ª</p>
    </div>
    
    <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="section-title">
                <i class="fas fa-star"></i>–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã
            </h2>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="feature-card">
                <div class="feature-icon mx-auto">
                    <i class="fas fa-truck"></i>
                </div>
                <h5>–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</h5>
                <p class="text-muted">–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="feature-card">
                <div class="feature-icon mx-auto">
                    <i class="fas fa-leaf"></i>
                </div>
                <h5>–°–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h5>
                <p class="text-muted">–¢–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏ —Å–≤–µ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="feature-card">
                <div class="feature-icon mx-auto">
                    <i class="fas fa-heart"></i>
                </div>
                <h5>–ó–∞–±–æ—Ç–∞ –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö</h5>
                <p class="text-muted">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –ø–æ–∫—É–ø–∞—Ç–µ–ª—é</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="feature-card">
                <div class="feature-icon mx-auto">
                    <i class="fas fa-credit-card"></i>
                </div>
                <h5>–£–¥–æ–±–Ω–∞—è –æ–ø–ª–∞—Ç–∞</h5>
                <p class="text-muted">–ü—Ä–∏–Ω–∏–º–∞–µ–º –≤—Å–µ –≤–∏–¥—ã –ø–ª–∞—Ç–µ–∂–µ–π</p>
            </div>
        </div>
    </div>
    
    <!-- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é -->
    <div class="row">
        <div class="col-12">
            <div class="card stores-cta">
                <div class="card-body text-center py-5">
                    <h2 class="mb-3">üê∑ –ü–æ—Å–µ—Ç–∏—Ç–µ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω!</h2>
                    <p class="lead mb-4">–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–∞—à–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ª–∏—á–Ω–æ</p>
                    <a href="{% url 'product_list' %}" class="btn btn-cta">
                        <i class="fas fa-shopping-bag me-2"></i>–°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const storeCards = document.querySelectorAll('.store-card');
    const storeColumns = document.querySelectorAll('.store-column');
    const searchInput = document.getElementById('storesSearchInput');
    const visibleCounter = document.getElementById('storesVisibleCounter');
    const emptyState = document.getElementById('storesEmptyState');
    
    storeCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    });
    
    storeCards.forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });

    function applyStoreFilter(query = '') {
        const normalizedQuery = query.trim().toLowerCase();
        let visibleCount = 0;
        storeColumns.forEach(col => {
            const haystack = `${col.dataset.storeName} ${col.dataset.storeAddress} ${col.dataset.storePhone}`.trim();
            const isMatch = haystack.includes(normalizedQuery);
            col.style.display = isMatch ? '' : 'none';
            if (isMatch) {
                visibleCount += 1;
            }
        });
        if (visibleCounter) {
            visibleCounter.textContent = visibleCount;
        }
        if (emptyState) {
            emptyState.style.display = visibleCount ? 'none' : 'block';
        }
    }

    if (searchInput) {
        searchInput.addEventListener('input', (event) => {
            applyStoreFilter(event.target.value);
        });
    }

    document.querySelectorAll('.btn-filter[data-suggest]').forEach(btn => {
        btn.addEventListener('click', () => {
            const value = btn.dataset.suggest || '';
            if (searchInput) {
                searchInput.value = value;
                searchInput.focus();
            }
            applyStoreFilter(value);
        });
    });

    document.getElementById('storesSearchReset')?.addEventListener('click', () => {
        if (searchInput) {
            searchInput.value = '';
            searchInput.focus();
        }
        applyStoreFilter('');
    });

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    applyStoreFilter('');
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
function copyAddress(address) {
    navigator.clipboard.writeText(address).then(function() {
        showToast('–ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>
{% endblock %}
