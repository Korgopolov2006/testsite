{% extends 'paint_shop_project/base.html' %}
{% load static %}
{% load admin_filters %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ - –ñ–µ–≤–∂–∏–∫{% endblock %}

{% block extra_css %}
<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ */
.catalog-header {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: var(--white);
    padding: 40px 0;
    margin-bottom: 40px;
}

.catalog-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 16px;
}

.catalog-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
}

.filters-section {
    background: var(--card-bg, var(--white));
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    padding: 24px;
    margin-bottom: 30px;
    color: var(--text-color, var(--dark-gray));
}

.filter-group {
    margin-bottom: 20px;
}

.filter-label {
    font-weight: 600;
    color: var(--text-color, var(--dark-gray));
    margin-bottom: 8px;
    display: block;
}

.filter-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-color, #e9ecef);
    border-radius: var(--border-radius);
    transition: var(--transition);
    background-color: var(--input-bg, var(--white));
    color: var(--text-color, var(--dark-gray));
}

.filter-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
    background-color: var(--input-bg, var(--white));
    color: var(--text-color, var(--dark-gray));
}

.filter-select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-color, #e9ecef);
    border-radius: var(--border-radius);
    background: var(--input-bg, var(--white));
    transition: var(--transition);
    color: var(--text-color, var(--dark-gray));
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
}

.product-card {
    background: var(--card-bg, var(--white));
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: var(--transition);
    position: relative;
    display: flex;
    flex-direction: column;
    color: var(--text-color, var(--dark-gray));
}

.product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–∫–æ–Ω—á–∏–≤—à–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤ */
.product-card.out-of-stock {
    opacity: 0.5;
    filter: grayscale(0.7);
    pointer-events: none;
}

.product-card.out-of-stock:hover {
    transform: none;
    box-shadow: var(--shadow);
}

.product-card.out-of-stock .product-image {
    opacity: 0.6;
}

.product-card.out-of-stock .product-content {
    opacity: 0.7;
}

.out-of-stock-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: rgba(220, 53, 69, 0.95);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    z-index: 10;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.product-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: var(--light-gray);
}

.product-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: var(--accent-color);
    color: var(--white);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
}

.product-new-badge {
    background: var(--success-color);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏ */
.product-expiry {
    margin: 8px 0;
}

.expiry-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
    text-align: center;
}

.expiry-badge.expired {
    background-color: #dc3545;
    color: white;
}

.expiry-badge.expires-soon {
    background-color: #ffc107;
    color: #212529;
}

.expiry-badge.expires-week {
    background-color: #17a2b8;
    color: white;
}

.expiry-badge.fresh {
    background-color: #28a745;
    color: white;
}

.product-content {
    padding: 20px;
    display: flex;
    flex-direction: column;
    flex: 1;
}

.product-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-color, var(--dark-gray));
    margin-bottom: 8px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.product-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.product-old-price {
    font-size: 1rem;
    color: var(--medium-gray);
    text-decoration: line-through;
    margin-left: 8px;
}

.product-rating {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
}

.rating-stars {
    color: var(--secondary-color);
}

.rating-count {
    font-size: 0.875rem;
    color: var(--medium-gray);
}

.product-actions {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: auto;
}

.product-actions .btn-add-cart,
.product-actions .cart-quantity-control {
    flex: 1;
}

.cart-quantity-control {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    background: var(--light-gray);
    border-radius: 10px;
    padding: 6px 10px;
}

.btn-quantity {
    background: transparent;
    border: none;
    color: var(--primary-color);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: var(--transition);
}

.btn-quantity:hover {
    background: rgba(255, 107, 157, 0.1);
    color: var(--primary-dark);
}

.btn-quantity:active {
    transform: scale(0.95);
}

.btn-quantity.btn-minus {
    border-color: var(--danger-color);
    color: var(--danger-color);
}

.btn-quantity.btn-minus:hover {
    background: var(--danger-color);
    color: var(--white);
}

.cart-qty-display {
    display: flex;
    align-items: baseline;
    gap: 4px;
    font-weight: 600;
    color: var(--dark-gray);
}

.cart-qty-display .qty {
    font-size: 1.1rem;
}

.cart-qty-display small {
    font-size: 0.75rem;
    color: var(--medium-gray);
}

.btn-add-cart {
    background: var(--primary-color);
    color: var(--white);
    border: none;
    padding: 10px 16px;
    border-radius: 10px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: var(--transition);
}

.btn-add-cart:hover {
    background: var(--primary-dark);
    color: var(--white);
    transform: translateY(-1px);
}

.btn-favorite {
    background: rgba(255, 107, 157, 0.12);
    color: var(--primary-color);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.btn-favorite:hover {
    background: var(--primary-color);
    color: var(--white);
}

.btn-favorite.active {
    background: var(--primary-color);
    color: var(--white);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ */
.cart-quantity-control {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
}

.btn-quantity {
    width: 36px;
    height: 36px;
    border: 2px solid var(--primary-color);
    background: var(--white);
    color: var(--primary-color);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    padding: 0;
}

.btn-quantity:hover {
    background: var(--primary-color);
    color: var(--white);
}

.btn-quantity:active {
    transform: scale(0.95);
}

.btn-quantity.btn-minus {
    border-color: var(--danger-color);
    color: var(--danger-color);
}

.btn-quantity.btn-minus:hover {
    background: var(--danger-color);
    color: var(--white);
}

.cart-qty-display {
    display: flex;
    align-items: center;
    gap: 4px;
    min-width: 50px;
    justify-content: center;
    font-weight: 600;
    color: var(--dark-gray);
}

.cart-qty-display .qty {
    font-size: 1.1rem;
}

.cart-qty-display small {
    font-size: 0.75rem;
    color: var(--medium-gray);
}

.pagination-wrapper {
    display: flex;
    justify-content: center;
    margin-top: 40px;
}

.pagination {
    gap: 8px;
}

.pagination .page-link {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    color: var(--primary-color);
    padding: 10px 16px;
    transition: var(--transition);
}

.pagination .page-link:hover {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: var(--white);
}

.pagination .page-item.active .page-link {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

.empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--medium-gray);
}

.empty-state i {
    font-size: 4rem;
    color: var(--primary-light);
    margin-bottom: 20px;
}

.empty-state h3 {
    color: var(--dark-gray);
    margin-bottom: 16px;
}

.results-info {
    background: var(--light-gray);
    border-radius: var(--border-radius);
    padding: 16px 20px;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 16px;
}

.results-count {
    font-weight: 600;
    color: var(--dark-gray);
}

.view-toggle {
    display: flex;
    gap: 8px;
}

.view-btn {
    background: var(--white);
    border: 2px solid #e9ecef;
    color: var(--medium-gray);
    padding: 8px 12px;
    border-radius: 8px;
    transition: var(--transition);
    cursor: pointer;
}

.view-btn.active {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: var(--white);
}

.view-btn:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .catalog-title {
        font-size: 2rem;
    }
    
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 16px;
    }
    
    .filters-section {
        padding: 16px;
    }
    
    .results-info {
        flex-direction: column;
        align-items: flex-start;
    }
}

@media (max-width: 480px) {
    .products-grid {
        grid-template-columns: 1fr;
    }
    
    .product-actions {
        flex-direction: column;
    }
    
    .btn-add-cart {
        width: 100%;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–∞–ª–æ–≥–∞ -->
<div class="catalog-header">
    <div class="container">
        <div class="text-center">
            <h1 class="catalog-title">üê∑ –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
            <p class="catalog-subtitle">–°–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Å—Ç–æ–ª–∞</p>
        </div>
    </div>
</div>

<div class="container">
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters-section">
        <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="mb-3 d-flex flex-wrap gap-2">
            <a href="{% url 'product_list' %}" class="btn btn-outline-primary btn-sm {% if not selected_category %}active{% endif %}">–í—Å–µ</a>
            {% for category in categories %}
                <a href="{% url 'product_list' %}?category={{ category.id }}"
                   class="btn btn-outline-primary btn-sm {% if selected_category == category.id %}active{% endif %}">
                    {{ category.name }}
                </a>
            {% endfor %}
        </div>
        <form method="get" id="filterForm">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="filter-label">–ü–æ–∏—Å–∫</label>
                    <input type="text" name="search" class="filter-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." value="{{ search_query|default:'' }}">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="filter-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select name="category" class="filter-select">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                    <select name="sort" class="filter-select">
                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                        <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                        <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                        <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                    </select>
                </div>
                <div class="col-md-2 mb-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> –ù–∞–π—Ç–∏
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö -->
    {% if products %}
    <div class="results-info">
        <div class="results-count">
            –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ products.paginator.count }}
            {% if search_query %}
                –ø–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}"
            {% endif %}
            {% if selected_category_obj %}
                –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "{{ selected_category_obj.name }}"
            {% endif %}
        </div>
        <div class="view-toggle">
            <button class="view-btn active" onclick="toggleView('grid')">
                <i class="fas fa-th"></i>
            </button>
            <button class="view-btn" onclick="toggleView('list')">
                <i class="fas fa-list"></i>
            </button>
        </div>
    </div>
    {% endif %}

    <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
    {% if products %}
        <div class="products-grid" id="productsGrid">
            {% for product in products %}
            <div class="product-card {% if not product.is_available %}out-of-stock{% endif %}" data-product-id="{{ product.id }}">
                {% if product.image %}
                    <a href="{% url 'product_detail' product.id %}"><img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image"></a>
                {% else %}
                    <div class="product-image d-flex align-items-center justify-content-center">
                        <i class="fas fa-image fa-3x text-muted"></i>
                    </div>
                {% endif %}
                
                {% if not product.is_available %}
                    <div class="out-of-stock-badge">
                        <i class="fas fa-times-circle"></i> –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                    </div>
                {% endif %}
                
                {% if product.discount_percent > 0 %}
                    <div class="product-badge">-{{ product.discount_percent }}%</div>
                {% endif %}
                
                {% if product.is_featured %}
                    <div class="product-badge product-new-badge">–ù–æ–≤–∏–Ω–∫–∞</div>
                {% endif %}
                
                <div class="product-content">
                    <h3 class="product-name"><a href="{% url 'product_detail' product.id %}" class="text-decoration-none text-dark">{{ product.name }}</a></h3>
                    <div class="product-price">
                        {{ product.price }} ‚ÇΩ
                        {% if product.old_price %}
                            <span class="product-old-price">{{ product.old_price }} ‚ÇΩ</span>
                        {% endif %}
                    </div>
                    
                    <div class="product-rating">
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= product.rating %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="rating-count">({{ product.reviews.count }})</span>
                    </div>
                    
                    {% if product.has_expiry_date %}
                    <div class="product-expiry">
                        {% if product.is_expired %}
                            <span class="expiry-badge expired">
                                <i class="fas fa-exclamation-triangle"></i> –ü—Ä–æ—Å—Ä–æ—á–µ–Ω
                            </span>
                        {% elif product.expiry_status == 'expires_soon' %}
                            <span class="expiry-badge expires-soon">
                                <i class="fas fa-clock"></i> –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ {{ product.days_until_expiry }} –¥–Ω.
                            </span>
                        {% elif product.expiry_status == 'expires_week' %}
                            <span class="expiry-badge expires-week">
                                <i class="fas fa-calendar"></i> –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ {{ product.days_until_expiry }} –¥–Ω.
                            </span>
                        {% else %}
                            <span class="expiry-badge fresh">
                                <i class="fas fa-check"></i> –°–≤–µ–∂–∏–π ({{ product.days_until_expiry }} –¥–Ω.)
                            </span>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <div class="product-actions">
                        {% if not product.is_available %}
                            <!-- –¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É -->
                            <button class="btn-add-cart" disabled style="opacity: 0.5; cursor: not-allowed;">
                                <i class="fas fa-ban"></i>
                                –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                            </button>
                        {% elif user.is_authenticated %}
                            {% if product_id_to_qty %}
                                {% with qty=product_id_to_qty|get_item:product.id|default:0 %}
                                    {% if qty %}
                                        <!-- –ë–ª–æ–∫ —Å +/- –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ -->
                                        <div class="cart-quantity-control" id="cart-control-{{ product.id }}" style="display: flex; align-items: center; gap: 8px;">
                                            <button class="btn-quantity btn-minus" onclick="updateCartQuantityFromCatalog({{ product.id }}, -1)" title="–£–º–µ–Ω—å—à–∏—Ç—å">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="cart-qty-display">
                                                <span class="qty" id="qty-{{ product.id }}">{{ qty }}</span>
                                                <small class="text-muted">—à—Ç.</small>
                                            </span>
                                            <button class="btn-quantity btn-plus" onclick="updateCartQuantityFromCatalog({{ product.id }}, 1)" title="–£–≤–µ–ª–∏—á–∏—Ç—å">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–Ω–µ—Ç 0) -->
                                        <button class="btn-add-cart" onclick="addToCart({{ product.id }})" id="add-btn-{{ product.id }}" style="display: none;">
                                            <i class="fas fa-shopping-cart"></i>
                                            –í –∫–æ—Ä–∑–∏–Ω—É
                                        </button>
                                    {% else %}
                                        <!-- –ö–Ω–æ–ø–∫–∞ "–í –∫–æ—Ä–∑–∏–Ω—É" -->
                                        <button class="btn-add-cart" onclick="addToCart({{ product.id }})" id="add-btn-{{ product.id }}">
                                            <i class="fas fa-shopping-cart"></i>
                                            –í –∫–æ—Ä–∑–∏–Ω—É
                                        </button>
                                        <!-- –°–∫—Ä—ã—Ç—ã–π –±–ª–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è) -->
                                        <div class="cart-quantity-control" id="cart-control-{{ product.id }}" style="display: none; align-items: center; gap: 8px;">
                                            <button class="btn-quantity btn-minus" onclick="updateCartQuantityFromCatalog({{ product.id }}, -1)" title="–£–º–µ–Ω—å—à–∏—Ç—å">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="cart-qty-display">
                                                <span class="qty" id="qty-{{ product.id }}">0</span>
                                                <small class="text-muted">—à—Ç.</small>
                                            </span>
                                            <button class="btn-quantity btn-plus" onclick="updateCartQuantityFromCatalog({{ product.id }}, 1)" title="–£–≤–µ–ª–∏—á–∏—Ç—å">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    {% endif %}
                                {% endwith %}
                            {% else %}
                                <!-- –ö–Ω–æ–ø–∫–∞ "–í –∫–æ—Ä–∑–∏–Ω—É" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                                <button class="btn-add-cart" onclick="addToCart({{ product.id }})" id="add-btn-{{ product.id }}">
                                    <i class="fas fa-shopping-cart"></i>
                                    –í –∫–æ—Ä–∑–∏–Ω—É
                                </button>
                                <!-- –°–∫—Ä—ã—Ç—ã–π –±–ª–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è) -->
                                <div class="cart-quantity-control" id="cart-control-{{ product.id }}" style="display: none; align-items: center; gap: 8px;">
                                    <button class="btn-quantity btn-minus" onclick="updateCartQuantityFromCatalog({{ product.id }}, -1)" title="–£–º–µ–Ω—å—à–∏—Ç—å">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="cart-qty-display">
                                        <span class="qty" id="qty-{{ product.id }}">0</span>
                                        <small class="text-muted">—à—Ç.</small>
                                    </span>
                                    <button class="btn-quantity btn-plus" onclick="updateCartQuantityFromCatalog({{ product.id }}, 1)" title="–£–≤–µ–ª–∏—á–∏—Ç—å">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'login' %}" class="btn-add-cart">
                                <i class="fas fa-sign-in-alt"></i>
                                –í–æ–π—Ç–∏
                            </a>
                        {% endif %}
                        <button class="btn-favorite" onclick="toggleFavorite({{ product.id }})">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if products.has_other_pages %}
        <div class="pagination-wrapper">
            <nav>
                <ul class="pagination">
                    {% if products.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.id }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.id }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>
                    {% endif %}

                    {% for num in products.paginator.page_range %}
                        {% if products.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.id }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if products.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.id }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.id }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    {% else %}
        <div class="empty-state">
            <i class="fas fa-search"></i>
            <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
            <a href="{% url 'product_list' %}" class="btn btn-primary">
                <i class="fas fa-refresh"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
            </a>
        </div>
    {% endif %}
</div>

<!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è CSRF —Ç–æ–∫–µ–Ω–∞ -->
{% csrf_token %}

<script>
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
function addToCart(productId) {
    const formData = new FormData();
    const csrfToken = getCSRFToken();
    if (!csrfToken) {
        console.error('CSRF token not found');
        showToast('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
        return;
    }
    formData.append('csrfmiddlewaretoken', csrfToken);
    
    fetch(`/add-to-cart/${productId}/`, {
        method: 'POST',
        headers: { 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json' },
        body: formData,
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast(data.message, 'success');
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫
            if (typeof updateCartCounter === 'function') {
                updateCartCounter();
            }
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í –∫–æ—Ä–∑–∏–Ω—É", –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            const addBtn = document.getElementById(`add-btn-${productId}`);
            const controlDiv = document.getElementById(`cart-control-${productId}`);
            const qtyEl = document.getElementById(`qty-${productId}`);
            
            if (addBtn) addBtn.style.display = 'none';
            if (controlDiv) controlDiv.style.display = 'flex';
            if (qtyEl && typeof data.quantity !== 'undefined') {
                qtyEl.textContent = data.quantity;
            } else if (qtyEl) {
                const current = parseInt(qtyEl.textContent || '0', 10) || 0;
                qtyEl.textContent = current + 1;
            }
        } else {
            showToast(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
function updateCartQuantityFromCatalog(productId, delta) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –ª–∏ —Ç–æ–≤–∞—Ä (–µ—Å–ª–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
    if (delta > 0) {
        const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`) || 
                           document.querySelector(`#add-btn-${productId}`)?.closest('.product-card');
        if (productCard && productCard.classList.contains('out-of-stock')) {
            showToast('–¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–∫–∞–∑–∞', 'error');
            return;
        }
    }
    
    // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    const qtyEl = document.getElementById(`qty-${productId}`);
    const currentQty = parseInt(qtyEl ? qtyEl.textContent : '0', 10) || 0;
    const newQty = Math.max(0, currentQty + delta);
    
    if (newQty === 0) {
        // –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–ª–æ 0, —É–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
        removeFromCartFromCatalog(productId);
        return;
    }
    
    if (delta > 0) {
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º: –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä
        addToCart(productId);
    } else {
        // –£–º–µ–Ω—å—à–∞–µ–º: –ø–æ–ª—É—á–∞–µ–º cart_id –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        fetch(`/get-cart-id/${productId}/`, {
            method: 'GET',
            headers: { 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json' },
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.cart_id) {
                updateCartQuantity(data.cart_id, newQty, productId);
            } else {
                // –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω–µ, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                if (qtyEl) qtyEl.textContent = newQty;
                showToast('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            // Fallback: –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            if (qtyEl) qtyEl.textContent = newQty;
        });
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
function updateCartQuantity(cartId, quantity, productId) {
    const formData = new FormData();
    formData.append('csrfmiddlewaretoken', getCSRFToken());
    formData.append('quantity', quantity);
    
    fetch(`/update-cart-quantity/${cartId}/`, {
        method: 'POST',
        headers: { 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json' },
        body: formData,
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
            const qtyEl = document.getElementById(`qty-${productId}`);
            if (qtyEl) qtyEl.textContent = data.quantity || quantity;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫
            if (typeof updateCartCounter === 'function') {
                updateCartCounter();
            }
        } else {
            showToast(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞', 'error');
    });
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
function removeFromCartFromCatalog(productId) {
    // –ü–æ–ª—É—á–∞–µ–º cart_id –∏ —É–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä
    fetch(`/get-cart-id/${productId}/`, {
        method: 'GET',
        headers: { 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json' },
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.cart_id) {
            const formData = new FormData();
            formData.append('csrfmiddlewaretoken', getCSRFToken());
            
            fetch(`/remove-from-cart/${data.cart_id}/`, {
                method: 'POST',
                headers: { 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json' },
                body: formData,
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í –∫–æ—Ä–∑–∏–Ω—É", —Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è
                    const addBtn = document.getElementById(`add-btn-${productId}`);
                    const controlDiv = document.getElementById(`cart-control-${productId}`);
                    
                    if (addBtn) addBtn.style.display = 'inline-block';
                    if (controlDiv) controlDiv.style.display = 'none';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫
                    if (typeof updateCartCounter === 'function') {
                        updateCartCounter();
                    }
                    
                    showToast('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã', 'info');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
            });
        } else {
            // Fallback: –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const addBtn = document.getElementById(`add-btn-${productId}`);
            const controlDiv = document.getElementById(`cart-control-${productId}`);
            
            if (addBtn) addBtn.style.display = 'inline-block';
            if (controlDiv) controlDiv.style.display = 'none';
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
function toggleView(view) {
    const grid = document.getElementById('productsGrid');
    const buttons = document.querySelectorAll('.view-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.closest('.view-btn').classList.add('active');
    
    if (view === 'list') {
        grid.style.gridTemplateColumns = '1fr';
        grid.classList.add('list-view');
    } else {
        grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(280px, 1fr))';
        grid.classList.remove('list-view');
    }
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ (–ª—é–±–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã)
function toggleFavorite(productId) {
    console.log('[FAVORITES] toggleFavorite called for productId:', productId);
    {% if user.is_authenticated %}
    const btn = event.target.closest('.btn-favorite');
    const icon = btn.querySelector('i');
    console.log('[FAVORITES] Button found:', !!btn, 'Icon found:', !!icon);
    
    if (!btn) {
        console.error('[FAVORITES] Button not found!');
        return;
    }
    
    console.log('[FAVORITES] Sending request to /api/v1/favorites/toggle/');
    fetch(`/api/v1/favorites/toggle/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ product_id: productId })
    })
    .then(response => {
        console.log('[FAVORITES] Response status:', response.status, 'ok:', response.ok);
        if (!response.ok) {
            return response.json().then(errData => {
                console.error('[FAVORITES] Error response:', errData);
                return Promise.reject({ response, errData });
            });
        }
        return response.json();
    })
    .then(data => {
        console.log('[FAVORITES] Success response:', data);
        if (data.is_favorite) {
            btn.classList.add('active');
            icon.className = 'fas fa-heart';
            showToast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ª—é–±–∏–º—ã–µ (—Å–∫–∏–¥–∫–∞ 10%)', 'success');
            console.log('[FAVORITES] Product added to favorites');
        } else {
            btn.classList.remove('active');
            icon.className = 'far fa-heart';
            showToast('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –ª—é–±–∏–º—ã—Ö', 'info');
            console.log('[FAVORITES] Product removed from favorites');
        }
    })
    .catch(error => {
        console.error('[FAVORITES] Error:', error);
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏–∑ API
        if (error.errData) {
            const errData = error.errData;
            if (errData.error) {
                if (errData.max_reached) {
                    showFavoriteModal('–ú–∞–∫—Å–∏–º—É–º 4 –ª—é–±–∏–º—ã—Ö —Ç–æ–≤–∞—Ä–∞', '–£ –≤–∞—Å —É–∂–µ 4 –ª—é–±–∏–º—ã—Ö —Ç–æ–≤–∞—Ä–∞. –£–¥–∞–ª–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π.');
                } else if (errData.can_modify === false) {
                    const nextDate = errData.next_change_date ? new Date(errData.next_change_date).toLocaleDateString('ru-RU') : '–ø–æ–∑–∂–µ';
                    showFavoriteModal('–õ—é–±–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é', `–°–ª–µ–¥—É—é—â–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ ${nextDate}.`);
                } else {
                    showFavoriteModal('–û—à–∏–±–∫–∞', errData.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –ª—é–±–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã');
                }
            } else {
                showFavoriteModal('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –ª—é–±–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã');
            }
        } else {
            showFavoriteModal('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –ª—é–±–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã');
        }
    });
    {% else %}
    showToast('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –ª—é–±–∏–º—ã–µ', 'warning');
    {% endif %}
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ª—é–±–∏–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
function showFavoriteModal(title, message) {
    const modal = document.getElementById('favoriteModal');
    if (!modal) {
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        const modalHtml = `
            <div class="modal fade" id="favoriteModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">${title}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p>${message}</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">–ü–æ–Ω—è—Ç–Ω–æ</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    const modalElement = document.getElementById('favoriteModal');
    modalElement.querySelector('.modal-title').textContent = title;
    modalElement.querySelector('.modal-body p').textContent = message;
    const bsModal = new bootstrap.Modal(modalElement);
    bsModal.show();
}

// –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `toast position-fixed top-0 end-0 m-3`;
    toast.innerHTML = `
        <div class="toast-header bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} text-white">
            <strong class="me-auto">${message}</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
    `;
    document.body.appendChild(toast);
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    setTimeout(() => toast.remove(), 5000);
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
document.querySelectorAll('.filter-select').forEach(select => {
    select.addEventListener('change', function() {
        document.getElementById('filterForm').submit();
    });
});
</script>
{% endblock %}