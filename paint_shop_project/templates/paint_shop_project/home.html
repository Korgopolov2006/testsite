{% extends 'paint_shop_project/base.html' %}
{% load static %}
{% load math_filters %}

{% block title %}–ñ–µ–≤–∂–∏–∫ - –ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω —Å –º–∏–ª—ã–º –ø–æ—Ä–æ—Å–µ–Ω–∫–æ–º{% endblock %}

{% block extra_css %}
<style>
/* –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞ –≤ —Å—Ç–∏–ª–µ –ü—è—Ç—ë—Ä–æ—á–∫–∏ */
:root {
    --primary-color: #ff6b9d;
    --primary-dark: #e55a8a;
    --primary-light: #ffb3d1;
    --secondary-color: #ffd700;
    --accent-color: #ff4757;
    --success-color: #2ed573;
    --warning-color: #ffa502;
    --info-color: #3742fa;
    --light-gray: #f8f9fa;
    --medium-gray: #6c757d;
    --dark-gray: #2c3e50;
    --white: #ffffff;
    --shadow: 0 2px 10px rgba(0,0,0,0.1);
    --shadow-hover: 0 4px 20px rgba(0,0,0,0.15);
    --border-radius: 12px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
.top-bar {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: var(--white);
    padding: 8px 0;
    font-size: 0.875rem;
}

.top-bar a {
    color: var(--white);
    text-decoration: none;
    padding: 4px 12px;
    border-radius: 4px;
    transition: var(--transition);
}

.top-bar a:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--secondary-color);
}

/* –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
.main-header {
    background: var(--white);
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 0;
    gap: 20px;
}

/* –õ–æ–≥–æ—Ç–∏–ø */
.brand {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: var(--primary-color);
    font-weight: 700;
    font-size: 1.5rem;
}

.brand-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
    animation: pulse 2s infinite;
}

.brand-icon::before {
    content: "üê∑";
    font-size: 1.25rem;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* –ü–æ–∏—Å–∫ */
.search-container {
    flex: 1;
    max-width: 500px;
    position: relative;
}

.search-input {
    width: 100%;
    padding: 12px 50px 12px 16px;
    border: 2px solid #e9ecef;
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
    background: var(--light-gray);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    background: var(--white);
    box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
}

.search-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--primary-color);
    border: none;
    color: var(--white);
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.search-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-50%) scale(1.05);
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
.nav-menu {
    display: flex;
    align-items: center;
    gap: 24px;
    list-style: none;
    margin: 0;
    padding: 0;
}

.nav-item {
    position: relative;
}

.nav-link {
    color: var(--dark-gray);
    text-decoration: none;
    font-weight: 500;
    padding: 8px 16px;
    border-radius: 8px;
    transition: var(--transition);
}

.nav-link:hover {
    color: var(--primary-color);
    background: rgba(255, 107, 157, 0.1);
}

/* –ö–Ω–æ–ø–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ */
.catalog-btn {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: var(--white);
    border: none;
    padding: 12px 24px;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 1rem;
    box-shadow: var(--shadow);
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
}

.catalog-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
    color: var(--white);
}

/* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è */
.user-actions {
    display: flex;
    align-items: center;
    gap: 16px;
}

.user-action {
    color: var(--dark-gray);
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 8px;
    transition: var(--transition);
    position: relative;
}

.user-action:hover {
    color: var(--primary-color);
    background: rgba(255, 107, 157, 0.1);
}

.cart-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--accent-color);
    color: var(--white);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
}

/* –ü—Ä–æ–º–æ-–±–∞–Ω–Ω–µ—Ä */
.hero-banner {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: var(--white);
    padding: 40px 0;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.hero-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
    animation: float 20s infinite linear;
}

@keyframes float {
    0% { transform: translateY(0px); }
    100% { transform: translateY(-100px); }
}

.hero-content {
    position: relative;
    z-index: 2;
}

.hero-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 16px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.hero-subtitle {
    font-size: 1.25rem;
    margin-bottom: 24px;
    opacity: 0.9;
}

.hero-cta {
    background: var(--white);
    color: var(--primary-color);
    border: none;
    padding: 16px 32px;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 1.1rem;
    box-shadow: var(--shadow);
    transition: var(--transition);
    text-decoration: none;
    display: inline-block;
}

.hero-cta:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
    color: var(--primary-color);
}

/* –°–µ–∫—Ü–∏–∏ */
.section {
    padding: 60px 0;
}

.section-header {
    text-align: center;
    margin-bottom: 48px;
}

.section-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--dark-gray);
    margin-bottom: 16px;
}

.section-subtitle {
    font-size: 1.1rem;
    color: var(--medium-gray);
    max-width: 600px;
    margin: 0 auto;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 24px;
    margin-top: 40px;
}

.product-card {
    background: var(--white);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: var(--transition);
    position: relative;
    display: flex;
    flex-direction: column;
}

.product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
}

.product-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: var(--light-gray);
}

.product-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: var(--accent-color);
    color: var(--white);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
}

.product-content {
    padding: 20px;
    display: flex;
    flex-direction: column;
    flex: 1;
}

.product-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-gray);
    margin-bottom: 8px;
    line-height: 1.4;
}

.product-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 16px;
}

.product-old-price {
    font-size: 1rem;
    color: var(--medium-gray);
    text-decoration: line-through;
    margin-left: 8px;
}

.product-actions {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: auto;
}

.product-actions .btn-add-cart,
.product-actions .cart-quantity-control {
    flex: 1;
}

.cart-quantity-control {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    background: var(--light-gray);
    border-radius: 10px;
    padding: 6px 10px;
}

.btn-quantity {
    background: transparent;
    border: none;
    color: var(--primary-color);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: var(--transition);
}

.btn-quantity:hover {
    background: rgba(255, 107, 157, 0.1);
    color: var(--primary-dark);
}

.cart-qty-display {
    display: flex;
    align-items: baseline;
    gap: 4px;
    font-weight: 600;
    color: var(--dark-gray);
}

.btn-add-cart {
    background: var(--primary-color);
    color: var(--white);
    border: none;
    padding: 10px 16px;
    border-radius: 10px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: var(--transition);
}

.btn-add-cart:hover {
    background: var(--primary-dark);
    color: var(--white);
    transform: translateY(-1px);
}

.btn-secondary {
    background: transparent;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
    padding: 8px 16px;
    border-radius: 10px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.btn-secondary:hover {
    background: var(--primary-color);
    color: var(--white);
}

/* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
.categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 24px;
    margin-top: 40px;
}

.category-card {
    background: var(--white);
    border-radius: var(--border-radius);
    padding: 32px 24px;
    text-align: center;
    box-shadow: var(--shadow);
    transition: var(--transition);
    text-decoration: none;
    color: inherit;
}

.category-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
    color: inherit;
}

.category-icon {
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 1.5rem;
    color: var(--white);
}

.category-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-gray);
    margin-bottom: 8px;
}

.category-count {
    font-size: 0.875rem;
    color: var(--medium-gray);
}

/* –ü—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ */
.programs-section {
    background: var(--light-gray);
}

.programs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    margin-top: 40px;
}

.program-card {
    background: var(--white);
    border-radius: var(--border-radius);
    padding: 32px;
    text-align: center;
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.program-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
}

.program-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 2rem;
    color: var(--white);
}

.program-icon.green { background: var(--success-color); }
.program-icon.orange { background: var(--warning-color); }
.program-icon.blue { background: var(--info-color); }

.program-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--dark-gray);
    margin-bottom: 12px;
}

.program-description {
    color: var(--medium-gray);
    line-height: 1.6;
    margin-bottom: 20px;
}

.program-link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
    transition: var(--transition);
}

.program-link:hover {
    color: var(--primary-dark);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 16px;
    }
    
    .search-container {
        order: 3;
        max-width: 100%;
    }
    
    .nav-menu {
        flex-wrap: wrap;
        justify-content: center;
        gap: 16px;
    }
    
    .hero-title {
        font-size: 2rem;
    }
    
    .hero-subtitle {
        font-size: 1.1rem;
    }
    
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 16px;
    }
    
    .categories-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
    }
    
    .programs-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
}

@media (max-width: 480px) {
    .products-grid {
        grid-template-columns: 1fr;
    }
    
    .categories-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .section {
        padding: 40px 0;
    }
    
    .section-title {
        font-size: 1.75rem;
    }
}
</style>
{% endblock %}

{% block content %}

<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<!-- –ü—Ä–æ–º–æ-–±–∞–Ω–Ω–µ—Ä -->
<section class="hero-banner">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">üê∑ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ñ–µ–≤–∂–∏–∫!</h1>
            <a href="{% url 'product_list' %}" class="hero-cta">
                <i class="fas fa-shopping-bag"></i>
                –ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏
            </a>
        </div>
    </div>
</section>

<!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
            <p class="section-subtitle">–°–∞–º—ã–µ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –æ—Ç –Ω–∞—à–∏—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</p>
        </div>

        <div class="products-grid">
            {% for product in featured_products %}
            <div class="product-card">
                {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
                {% else %}
                    <div class="product-image d-flex align-items-center justify-content-center">
                        <i class="fas fa-image fa-3x text-muted"></i>
                    </div>
                {% endif %}
                
                {% if product.discount_percent > 0 %}
                    <div class="product-badge">-{{ product.discount_percent }}%</div>
                {% endif %}
                
                <div class="product-content">
                    <h3 class="product-name">{{ product.name }}</h3>
                    <div class="product-price">
                        {{ product.price }} ‚ÇΩ
                        {% if product.old_price %}
                            <span class="product-old-price">{{ product.old_price }} ‚ÇΩ</span>
                        {% endif %}
                    </div>
                    
                    <div class="product-actions">
                        {% if user.is_authenticated %}
                            {% if product_id_to_qty %}
                                {% with qty=product_id_to_qty|get_item:product.id|default:0 %}
                                    {% if qty %}
                                        <div class="cart-quantity-control" id="home-cart-control-{{ product.id }}">
                                            <button class="btn-quantity btn-minus" onclick="updateCartQuantityFromHome({{ product.id }}, -1)"><i class="fas fa-minus"></i></button>
                                            <span class="cart-qty-display"><span class="qty" id="home-qty-{{ product.id }}">{{ qty }}</span><small class="text-muted">—à—Ç.</small></span>
                                            <button class="btn-quantity btn-plus" onclick="updateCartQuantityFromHome({{ product.id }}, 1)"><i class="fas fa-plus"></i></button>
                                        </div>
                                        <button class="btn-add-cart" id="home-add-btn-{{ product.id }}" style="display:none;">
                                            <i class="fas fa-shopping-cart"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                            </button>
                        {% else %}
                                        <button class="btn-add-cart" id="home-add-btn-{{ product.id }}" onclick="addToCartFromHome({{ product.id }})">
                                            <i class="fas fa-shopping-cart"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                                        </button>
                                        <div class="cart-quantity-control" id="home-cart-control-{{ product.id }}" style="display:none;">
                                            <button class="btn-quantity btn-minus" onclick="updateCartQuantityFromHome({{ product.id }}, -1)"><i class="fas fa-minus"></i></button>
                                            <span class="cart-qty-display"><span class="qty" id="home-qty-{{ product.id }}">0</span><small class="text-muted">—à—Ç.</small></span>
                                            <button class="btn-quantity btn-plus" onclick="updateCartQuantityFromHome({{ product.id }}, 1)"><i class="fas fa-plus"></i></button>
                                        </div>
                        {% endif %}
                                {% endwith %}
                            {% else %}
                                <button class="btn-add-cart" id="home-add-btn-{{ product.id }}" onclick="addToCartFromHome({{ product.id }})">
                                    <i class="fas fa-shopping-cart"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                                </button>
                                <div class="cart-quantity-control" id="home-cart-control-{{ product.id }}" style="display:none;">
                                    <button class="btn-quantity btn-minus" onclick="updateCartQuantityFromHome({{ product.id }}, -1)"><i class="fas fa-minus"></i></button>
                                    <span class="cart-qty-display"><span class="qty" id="home-qty-{{ product.id }}">0</span><small class="text-muted">—à—Ç.</small></span>
                                    <button class="btn-quantity btn-plus" onclick="updateCartQuantityFromHome({{ product.id }}, 1)"><i class="fas fa-plus"></i></button>
                                </div>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'login' %}" class="btn-add-cart">
                                <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                            </a>
                        {% endif %}
                        <a href="{% url 'product_detail' product.id %}" class="btn-secondary"><i class="fas fa-eye"></i></a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
                <h4>–¢–æ–≤–∞—Ä—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è!</h4>
                <p class="text-muted">–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–∞—Ç–∞–ª–æ–≥–∞</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</h2>
            <p class="section-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é –≤–∞—Å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
        </div>

        <div class="categories-grid">
            {% for category in categories %}
            <a href="{% url 'product_list' %}?category={{ category.id }}" class="category-card">
                <div class="category-icon">
                    {% if category.name == "–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã" %}
                        <i class="fas fa-wine-bottle"></i>
                    {% elif category.name == "–ú—è—Å–æ –∏ –ø—Ç–∏—Ü–∞" %}
                        <i class="fas fa-drumstick-bite"></i>
                    {% elif category.name == "–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã" %}
                        <i class="fas fa-apple-alt"></i>
                    {% elif category.name == "–•–ª–µ–± –∏ –≤—ã–ø–µ—á–∫–∞" %}
                        <i class="fas fa-bread-slice"></i>
                    {% elif category.name == "–ù–∞–ø–∏—Ç–∫–∏" %}
                        <i class="fas fa-coffee"></i>
                    {% else %}
                        <i class="fas fa-shopping-basket"></i>
                    {% endif %}
                </div>
                <h3 class="category-name">{{ category.name }}</h3>
                <p class="category-count">{{ category.product_set.count }} —Ç–æ–≤–∞—Ä–æ–≤</p>
            </a>
            {% endfor %}
        </div>
    </div>
</section>

<!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–∞–∫ —É –ü—è—Ç—ë—Ä–æ—á–∫–∏ -->
<section class="section py-5" style="background: #f8f9fa;">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2 class="display-5 fw-bold text-dark">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –ñ–µ–≤–∂–∏–∫?</h2>
                <p class="lead text-muted">–ú—ã –∑–∞–±–æ—Ç–∏–º—Å—è –æ –∫–∞–∂–¥–æ–º –∫–ª–∏–µ–Ω—Ç–µ</p>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-md-3 col-sm-6">
                <div class="text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-truck fa-2x"></i>
                    </div>
                    <h5 class="fw-bold">–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</h5>
                    <p class="text-muted small">–î–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞ 30 –º–∏–Ω—É—Ç –≤ —Ä–∞–¥–∏—É—Å–µ 5 –∫–º</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="text-center">
                    <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-leaf fa-2x"></i>
                    </div>
                    <h5 class="fw-bold">–°–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h5>
                    <p class="text-muted small">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ —Å–≤–µ–∂–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ñ–µ—Ä–º–µ—Ä–æ–≤</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="text-center">
                    <div class="bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-ruble-sign fa-2x"></i>
                    </div>
                    <h5 class="fw-bold">–ù–∏–∑–∫–∏–µ —Ü–µ–Ω—ã</h5>
                    <p class="text-muted small">–ü—Ä—è–º—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –±–µ–∑ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="text-center">
                    <div class="bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-heart fa-2x"></i>
                    </div>
                    <h5 class="fw-bold">–ó–∞–±–æ—Ç–∞ –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö</h5>
                    <p class="text-muted small">–°–∫–∏–¥–∫–∏ –¥–ª—è –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä–æ–≤ –∏ –º–Ω–æ–≥–æ–¥–µ—Ç–Ω—ã—Ö —Å–µ–º–µ–π</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- –ü—Ä–æ–≥—Ä–∞–º–º—ã –ñ–µ–≤–∂–∏–∫–∞ —É–¥–∞–ª–µ–Ω—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É -->

<!-- –ù–æ–≤–∏–Ω–∫–∏ –∫–∞–∫ —É –ü—è—Ç—ë—Ä–æ—á–∫–∏ -->
<section class="section py-5" style="background: linear-gradient(135deg, #28a745, #20c997);">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2 class="text-white display-5 fw-bold">üÜï –ù–æ–≤–∏–Ω–∫–∏ —Å–µ–∑–æ–Ω–∞</h2>
                <p class="text-white lead">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ!</p>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card border-0 shadow-lg h-100">
                    <div class="card-body text-center p-4">
                        <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                            <i class="fas fa-seedling fa-2x"></i>
                        </div>
                        <h5 class="fw-bold text-success">–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–µ –æ–≤–æ—â–∏</h5>
                        <p class="text-muted">–°–≤–µ–∂–∏–µ –æ–≤–æ—â–∏ —Å –º–µ—Å—Ç–Ω—ã—Ö —Ñ–µ—Ä–º –±–µ–∑ —Ö–∏–º–∏–∫–∞—Ç–æ–≤</p>
                        <span class="badge bg-success">–ù–æ–≤–∏–Ω–∫–∞</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-0 shadow-lg h-100">
                    <div class="card-body text-center p-4">
                        <div class="bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                            <i class="fas fa-bread-slice fa-2x"></i>
                        </div>
                        <h5 class="fw-bold text-warning">–î–æ–º–∞—à–Ω—è—è –≤—ã–ø–µ—á–∫–∞</h5>
                        <p class="text-muted">–°–≤–µ–∂–∏–π —Ö–ª–µ–± –∏ –≤—ã–ø–µ—á–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</p>
                        <span class="badge bg-warning">–•–∏—Ç</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-0 shadow-lg h-100">
                    <div class="card-body text-center p-4">
                        <div class="bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                            <i class="fas fa-fish fa-2x"></i>
                        </div>
                        <h5 class="fw-bold text-info">–°–≤–µ–∂–∞—è —Ä—ã–±–∞</h5>
                        <p class="text-muted">–ú–æ—Ä—Å–∫–∞—è –∏ —Ä–µ—á–Ω–∞—è —Ä—ã–±–∞, –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è —É—Ç—Ä–æ–º</p>
                        <span class="badge bg-info">–°–≤–µ–∂–µ–µ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é -->
<section class="section py-5" style="background: #2c3e50;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="text-white display-6 fw-bold mb-3">üê∑ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–µ–º—å–µ –ñ–µ–≤–∂–∏–∫!</h2>
                <p class="text-white lead mb-0">–ü–æ–ª—É—á–∞–π—Ç–µ —Å–∫–∏–¥–∫–∏, —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –∞–∫—Ü–∏—è—Ö –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏</p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="{% url 'register' %}" class="btn btn-light btn-lg px-4 py-3">
                    <i class="fas fa-user-plus me-2"></i>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </a>
            </div>
        </div>
    </div>
</section>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
function addToCart(productId) {
    const formData = new FormData();
    formData.append('csrfmiddlewaretoken', getCSRFToken());
    
    fetch(`/add-to-cart/${productId}/`, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'Accept': 'application/json'
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'success');
            updateCartCounter();
            updateAddToCartButton(productId);
        } else {
            showToast(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"
function updateAddToCartButton(productId) {
    const button = document.querySelector(`button[onclick="addToCart(${productId})"]`);
    if (button) {
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ
        fetch('/cart-count/')
        .then(response => response.json())
        .then(data => {
            if (data.count > 0) {
                button.innerHTML = `<i class="fas fa-shopping-cart"></i> –í –∫–æ—Ä–∑–∏–Ω–µ (${data.count})`;
                button.classList.add('btn-success');
                button.classList.remove('btn-primary');
            }
        });
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
function getCSRFToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
function updateCartCounter() {
    fetch('/cart-count/')
        .then(response => response.json())
        .then(data => {
            const counter = document.getElementById('cart-counter');
            if (counter) {
                counter.textContent = data.count;
                counter.style.display = data.count > 0 ? 'inline' : 'none';
            }
        })
        .catch(error => console.error('Error updating cart counter:', error));
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showToast(message, type = 'info') {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const toast = document.createElement('div');
    toast.className = `toast-notification toast-${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        max-width: 300px;
        animation: slideIn 0.3s ease-out;
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
    `;
    document.head.appendChild(style);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM
    document.body.appendChild(toast);
    
    // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

function addToCartFromHome(productId){
    const formData = new FormData();
    formData.append('csrfmiddlewaretoken', getCSRFToken());
    fetch(`/add-to-cart/${productId}/`, {method:'POST', headers:{'X-Requested-With':'XMLHttpRequest','Accept':'application/json'}, body:formData})
    .then(r=>r.json()).then(data=>{
        if(data.success){
            const addBtn = document.getElementById(`home-add-btn-${productId}`);
            const control = document.getElementById(`home-cart-control-${productId}`);
            const qtyEl = document.getElementById(`home-qty-${productId}`);
            if(addBtn&&control&&qtyEl){ addBtn.style.display='none'; control.style.display='flex'; qtyEl.textContent = data.quantity || 1; }
            updateCartCounter();
            showToast('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!','success');
        } else { showToast(data.message||'–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É','error'); }
    }).catch(()=>showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É','error'));
}
function updateCartQuantityFromHome(productId, delta){
    // –ü–æ–ª—É—á–∞–µ–º cart_id —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏
    fetch(`/get-cart-id/${productId}/`).then(r=>r.json()).then(data=>{
        if(!data.success){ if(delta>0){ addToCartFromHome(productId); } return; }
        const cartId = data.cart_id; const qtySpan = document.getElementById(`home-qty-${productId}`);
        const currentQty = parseInt(qtySpan?.textContent||'0')||0; const newQty = Math.max(0, currentQty + delta);
        if(newQty===0){
            // —É–¥–∞–ª–µ–Ω–∏–µ
            fetch(`/remove-from-cart/${cartId}/`, {method:'POST', headers:{'X-CSRFToken': getCSRFToken(),'Content-Type':'application/json'}})
            .then(r=>r.json()).then(res=>{
                if(res.success){
                    document.getElementById(`home-cart-control-${productId}`).style.display='none';
                    document.getElementById(`home-add-btn-${productId}`).style.display='inline-flex';
                    updateCartCounter();
                }
            });
            return;
        }
        const formData = new FormData(); formData.append('quantity', newQty);
        fetch(`/update-cart-quantity/${cartId}/`, {method:'POST', headers:{'X-CSRFToken': getCSRFToken(), 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json'}, body: formData})
        .then(r=>r.json()).then(res=>{
            if(res.success){ qtySpan.textContent = res.quantity || newQty; updateCartCounter(); }
        });
    });
}
</script>
{% endblock %}