# ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

## 1. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π

**–°—Ç–∞—Ç—É—Å**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**:
- –°–æ–∑–¥–∞–Ω–∞ Django management –∫–æ–º–∞–Ω–¥–∞ `spoil_expired_batches`
- –ö–æ–º–∞–Ω–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏ —Å –æ—Å—Ç–∞—Ç–∫–æ–º > 0
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏ (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `remaining_quantity = 0`)
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ `BatchAuditLog`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ + Telegram)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è
python manage.py spoil_expired_batches --dry-run

# –°–ø–∏—Å–∞–Ω–∏–µ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
python manage.py spoil_expired_batches --notify

# –°–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏–π, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –Ω–∞ 3+ –¥–Ω—è
python manage.py spoil_expired_batches --days-overdue 3 --notify
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞**: –°–º. `BATCH_AUTOMATION_SETUP.md`

## 2. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

**–°—Ç–∞—Ç—É—Å**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `TelegramNotifier`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –ø–∞—Ä—Ç–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- Fallback –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –µ—Å–ª–∏ Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞**:
1. –î–æ–±–∞–≤—å—Ç–µ –≤ `settings.py`:
   ```python
   TELEGRAM_BOT_TOKEN = '–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞'
   TELEGRAM_ENABLE_NOTIFICATIONS = True
   ```
2. –£–∫–∞–∂–∏—Ç–µ `telegram_chat_id` –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
3. –í–∫–ª—é—á–∏—Ç–µ `telegram_notifications_enabled` –¥–ª—è –Ω—É–∂–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
- üì¶ –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–ø–∏—Å–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π
- –î–µ—Ç–∞–ª–∏ –ø–æ —Ç–æ–≤–∞—Ä–∞–º (–ø–µ—Ä–≤—ã–µ 10)
- –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–ø–∏—Å–∞–Ω–Ω–æ–≥–æ

## 3. ‚úÖ –ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–∞—Ä—Ç–∏–π

**–°—Ç–∞—Ç—É—Å**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**:
- –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `BatchAuditLog` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Django signals:
  - –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏–π
  - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤
  - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–π –∑–∞–∫–∞–∑–∞–º
  - –°–Ω—è—Ç–∏–µ –ø–∞—Ä—Ç–∏–π —Å –∑–∞–∫–∞–∑–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ
  - –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–π
- –†—É—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ –ø–∞—Ä—Ç–∏–π)
- –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø–æ–∏—Å–∫–æ–º

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –ª–æ–≥–∞—Ö**:
- –ü–∞—Ä—Ç–∏—è
- –î–µ–π—Å—Ç–≤–∏–µ (7 —Ç–∏–ø–æ–≤)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∏–ª–∏ "–°–∏—Å—Ç–µ–º–∞")
- –°—Ç–∞—Ä–æ–µ –∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –¥–µ—Ç–∞–ª—è–º–∏
- IP-–∞–¥—Ä–µ—Å
- –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è

**–î–æ—Å—Ç—É–ø**: –ê–¥–º–∏–Ω–∫–∞ ‚Üí –õ–æ–≥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–∞—Ä—Ç–∏–π

## 4. ‚úÖ Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏

**–°—Ç–∞—Ç—É—Å**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Ç–∏–π (`is_expired`)
- ‚úÖ –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏ (`expiry_percent_remaining`)
- ‚úÖ –ü—Ä–∞–≤–∏–ª–æ 70% —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ (`is_sellable`)
- ‚úÖ –†–∞—Å—á–µ—Ç –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ (`days_until_expiry`)
- ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–π –∑–∞–∫–∞–∑–∞–º (—É–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞)
- ‚úÖ –°–Ω—è—Ç–∏–µ –ø–∞—Ä—Ç–∏–π —Å –∑–∞–∫–∞–∑–æ–≤ (–≤–æ–∑–≤—Ä–∞—Ç –æ—Å—Ç–∞—Ç–∫–∞)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –∞—É–¥–∏—Ç–∞
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ —Å–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π
- ‚úÖ –†–µ–∂–∏–º dry-run –∫–æ–º–∞–Ω–¥—ã —Å–ø–∏—Å–∞–Ω–∏—è

**–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤**: `paint_shop_project/tests_batches.py`

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤**:
```bash
python manage.py test paint_shop_project.tests_batches
```

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á**: 4/4 (100%)
- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤**: 
  - `spoil_expired_batches.py` - –∫–æ–º–∞–Ω–¥–∞ —Å–ø–∏—Å–∞–Ω–∏—è
  - `batch_signals.py` - —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - `tests_batches.py` - unit-—Ç–µ—Å—Ç—ã
  - `BATCH_AUTOMATION_SETUP.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–°–æ–∑–¥–∞–Ω–æ –º–∏–≥—Ä–∞—Ü–∏–π**: 1 (`0023_add_batch_audit_log`)
- **–û–±–Ω–æ–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤**: 
  - `models.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `BatchAuditLog`
  - `admin.py` - –∞–¥–º–∏–Ω–∫–∞ –¥–ª—è –ª–æ–≥–æ–≤
  - `staff_views.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π —Å–±–æ—Ä—â–∏–∫–æ–≤
  - `apps.py` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
  - `spoil_expired_batches.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. –î–∞—à–±–æ—Ä–¥ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å–∫–ª–∞–¥–∞
2. –û—Ç—á–µ—Ç—ã –ø–æ –ø–∞—Ä—Ç–∏—è–º (—ç–∫—Å–ø–æ—Ä—Ç –≤ Excel/PDF)
3. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

–í—Å–µ –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! ‚úÖ


