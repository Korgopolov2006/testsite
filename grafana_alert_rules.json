{
  "name": "Zhevzhik Business Metrics Alerts",
  "interval": "30s",
  "rules": [
    {
      "uid": "orders_today_high",
      "title": "Высокое количество заказов сегодня",
      "condition": "C",
      "data": [
        {
          "refId": "A",
          "queryType": "",
          "relativeTimeRange": {
            "from": 300,
            "to": 0
          },
          "datasourceUid": "prometheus",
          "model": {
            "expr": "zhevzhik_orders_today",
            "refId": "A",
            "legendFormat": "Заказов сегодня",
            "interval": ""
          }
        },
        {
          "refId": "B",
          "queryType": "",
          "relativeTimeRange": {
            "from": 0,
            "to": 0
          },
          "datasourceUid": "__expr__",
          "model": {
            "conditions": [
              {
                "evaluator": {
                  "params": [50],
                  "type": "gt"
                },
                "operator": {
                  "type": "and"
                },
                "query": {
                  "params": ["A"]
                },
                "reducer": {
                  "params": [],
                  "type": "last"
                },
                "type": "query"
              }
            ],
            "datasource": {
              "type": "__expr__",
              "uid": "__expr__"
            },
            "hide": false,
            "refId": "B",
            "type": "math"
          }
        },
        {
          "refId": "C",
          "queryType": "",
          "relativeTimeRange": {
            "from": 0,
            "to": 0
          },
          "datasourceUid": "__expr__",
          "model": {
            "conditions": [
              {
                "evaluator": {
                  "params": [1],
                  "type": "gt"
                },
                "operator": {
                  "type": "and"
                },
                "query": {
                  "params": ["B"]
                },
                "reducer": {
                  "params": [],
                  "type": "last"
                },
                "type": "query"
              }
            ],
            "datasource": {
              "type": "__expr__",
              "uid": "__expr__"
            },
            "hide": false,
            "refId": "C",
            "type": "math"
          }
        }
      ],
      "noDataState": "NoData",
      "execErrState": "Alerting",
      "for": "5m",
      "annotations": {
        "summary": "Количество заказов сегодня: {{ $values.A }}",
        "description": "Обнаружено высокое количество заказов за сегодня: {{ $values.A }}. Порог: 50 заказов."
      },
      "labels": {
        "severity": "warning",
        "team": "business"
      }
    },
    {
      "uid": "orders_today_low",
      "title": "Низкое количество заказов сегодня",
      "condition": "C",
      "data": [
        {
          "refId": "A",
          "queryType": "",
          "relativeTimeRange": {
            "from": 600,
            "to": 0
          },
          "datasourceUid": "prometheus",
          "model": {
            "expr": "zhevzhik_orders_today",
            "refId": "A",
            "legendFormat": "Заказов сегодня",
            "interval": ""
          }
        },
        {
          "refId": "B",
          "queryType": "",
          "relativeTimeRange": {
            "from": 0,
            "to": 0
          },
          "datasourceUid": "__expr__",
          "model": {
            "conditions": [
              {
                "evaluator": {
                  "params": [5],
                  "type": "lt"
                },
                "operator": {
                  "type": "and"
                },
                "query": {
                  "params": ["A"]
                },
                "reducer": {
                  "params": [],
                  "type": "last"
                },
                "type": "query"
              }
            ],
            "datasource": {
              "type": "__expr__",
              "uid": "__expr__"
            },
            "hide": false,
            "refId": "B",
            "type": "math"
          }
        },
        {
          "refId": "C",
          "queryType": "",
          "relativeTimeRange": {
            "from": 0,
            "to": 0
          },
          "datasourceUid": "__expr__",
          "model": {
            "conditions": [
              {
                "evaluator": {
                  "params": [1],
                  "type": "gt"
                },
                "operator": {
                  "type": "and"
                },
                "query": {
                  "params": ["B"]
                },
                "reducer": {
                  "params": [],
                  "type": "last"
                },
                "type": "query"
              }
            ],
            "datasource": {
              "type": "__expr__",
              "uid": "__expr__"
            },
            "hide": false,
            "refId": "C",
            "type": "math"
          }
        }
      ],
      "noDataState": "NoData",
      "execErrState": "Alerting",
      "for": "10m",
      "annotations": {
        "summary": "Количество заказов сегодня: {{ $values.A }}",
        "description": "Обнаружено низкое количество заказов за сегодня: {{ $values.A }}. Порог: менее 5 заказов."
      },
      "labels": {
        "severity": "info",
        "team": "business"
      }
    },
    {
      "uid": "http_errors_high",
      "title": "Высокое количество HTTP ошибок",
      "condition": "C",
      "data": [
        {
          "refId": "A",
          "queryType": "",
          "relativeTimeRange": {
            "from": 300,
            "to": 0
          },
          "datasourceUid": "prometheus",
          "model": {
            "expr": "rate(zhevzhik_http_errors_total[5m])",
            "refId": "A",
            "legendFormat": "Ошибок/сек",
            "interval": ""
          }
        },
        {
          "refId": "B",
          "queryType": "",
          "relativeTimeRange": {
            "from": 0,
            "to": 0
          },
          "datasourceUid": "__expr__",
          "model": {
            "conditions": [
              {
                "evaluator": {
                  "params": [0.1],
                  "type": "gt"
                },
                "operator": {
                  "type": "and"
                },
                "query": {
                  "params": ["A"]
                },
                "reducer": {
                  "params": [],
                  "type": "last"
                },
                "type": "query"
              }
            ],
            "datasource": {
              "type": "__expr__",
              "uid": "__expr__"
            },
            "hide": false,
            "refId": "B",
            "type": "math"
          }
        },
        {
          "refId": "C",
          "queryType": "",
          "relativeTimeRange": {
            "from": 0,
            "to": 0
          },
          "datasourceUid": "__expr__",
          "model": {
            "conditions": [
              {
                "evaluator": {
                  "params": [1],
                  "type": "gt"
                },
                "operator": {
                  "type": "and"
                },
                "query": {
                  "params": ["B"]
                },
                "reducer": {
                  "params": [],
                  "type": "last"
                },
                "type": "query"
              }
            ],
            "datasource": {
              "type": "__expr__",
              "uid": "__expr__"
            },
            "hide": false,
            "refId": "C",
            "type": "math"
          }
        }
      ],
      "noDataState": "NoData",
      "execErrState": "Alerting",
      "for": "2m",
      "annotations": {
        "summary": "Скорость HTTP ошибок: {{ $values.A }} ошибок/сек",
        "description": "Обнаружена высокая скорость HTTP ошибок: {{ $values.A }} ошибок/сек. Порог: 0.1 ошибок/сек."
      },
      "labels": {
        "severity": "critical",
        "team": "devops"
      }
    }
  ]
}

