# –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Email –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ email –≤ `settings.py` –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- EMAIL_HOST, EMAIL_PORT, EMAIL_USE_SSL –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è Gmail

### 2. –ü–æ–ª—è Telegram –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –º–æ–¥–µ–ª—å User
- `telegram_chat_id` - ID —á–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
- `telegram_notifications_enabled` - —Ñ–ª–∞–≥ –≤–∫–ª—é—á–µ–Ω–∏—è Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞, –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `python manage.py migrate`

### 3. –ú–æ–¥—É–ª—å Telegram Bot —Å–æ–∑–¥–∞–Ω
- –§–∞–π–ª `paint_shop_project/telegram_bot.py` —Å –∫–ª–∞—Å—Å–æ–º `TelegramNotifier`
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –±—ç–∫–∞–ø–∞—Ö
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∑–∞–¥–∞—á–∞–º–∏ Celery

### 4. –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–∞–ø–∞
- –ö–Ω–æ–ø–∫–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∞–¥–º–∏–Ω–∫–∏: "üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–∞–ø –≤—Ä—É—á–Ω—É—é"
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `database.py` (–¥–µ–π—Å—Ç–≤–∏–µ `run-manual-backup`)

### 5. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –±—ç–∫–∞–ø–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 20 –∑–∞–ø–∏—Å–µ–π
- –¢–∞–±–ª–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ, —Ä–∞–∑–º–µ—Ä–µ, –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Telegram
- –§–∞–π–ª `TELEGRAM_SETUP.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

### 1. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `run-manual-backup` –≤ `database.py`
–í –º–µ—Ç–æ–¥–µ `post()` –∫–ª–∞—Å—Å–∞ `DatabaseMaintenanceView`, –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `test-connection`, –¥–æ–±–∞–≤–∏—Ç—å:

```python
if action == "run-manual-backup":
    try:
        try:
            from paint_shop_project.tasks import create_scheduled_backup
            task = create_scheduled_backup.delay(
                comment=f"–†—É—á–Ω–æ–π –±—ç–∫–∞–ø –æ—Ç {request.user.username}"
            )
            messages.success(request, _("–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –ó–∞–¥–∞—á–∞ ID: %s") % task.id)
        except ImportError:
            backup_path = perform_backup(
                label="manual",
                created_by=request.user,
                comment=f"–†—É—á–Ω–æ–π –±—ç–∫–∞–ø –æ—Ç {request.user.username}",
            )
            messages.success(request, _("–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞: %s") % backup_path.name)
    except Exception as exc:
        logger.error("Failed to start manual backup: %s", exc)
        messages.error(request, _("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é: %s") % str(exc))
    return redirect(self._self_url())
```

### 2. –î–æ–±–∞–≤–∏—Ç—å `backup_history` –≤ context
–í –º–µ—Ç–æ–¥–µ `get_context_data()` –∫–ª–∞—Å—Å–∞ `DatabaseMaintenanceView`, –ø–µ—Ä–µ–¥ `context.update()`:

```python
backup_history = DatabaseBackup.objects.all().order_by('-started_at')[:20]
```

–ò –≤ —Å–ª–æ–≤–∞—Ä–µ context –¥–æ–±–∞–≤–∏—Ç—å:
```python
"backup_history": backup_history,
```

### 3. –î–æ–±–∞–≤–∏—Ç—å `send_telegram_notifications` –≤ `tasks.py`
–ü–æ—Å–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ `send_backup_notification()` –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `send_telegram_notifications()` –∏ –≤—ã–∑—ã–≤–∞—Ç—å –µ—ë –≤ –Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö.

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram

1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –≤ Telegram
2. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `TELEGRAM_BOT_TOKEN` –∏–ª–∏ –≤ `settings.py`
3. –ü–æ–ª—É—á–∏—Ç—å Chat ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—á–µ—Ä–µ–∑ @userinfobot)
4. –í –∞–¥–º–∏–Ω–∫–µ Django –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å:
   - Telegram Chat ID
   - –í–∫–ª—é—á–∏—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏: `python manage.py migrate`
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ `database.py`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è




